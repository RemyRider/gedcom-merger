import{r as p,a as ss,R as ts}from"./react-vendor-DghaKJPf.js";import{U as Se,S as Ae,R as as,a as Ee,b as is,F as ls,A as Pe,C as ns,c as rs,B as cs,T as ds,d as De,D as os}from"./lucide-DVQiqCb7.js";(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))v(f);new MutationObserver(f=>{for(const N of f)if(N.type==="childList")for(const b of N.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&v(b)}).observe(document,{childList:!0,subtree:!0});function E(f){const N={};return f.integrity&&(N.integrity=f.integrity),f.referrerPolicy&&(N.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?N.credentials="include":f.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function v(f){if(f.ep)return;f.ep=!0;const N=E(f);fetch(f.href,N)}})();var Te={exports:{}},V={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hs=p,ms=Symbol.for("react.element"),us=Symbol.for("react.fragment"),xs=Object.prototype.hasOwnProperty,gs=hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fs={key:!0,ref:!0,__self:!0,__source:!0};function Ie(I,y,E){var v,f={},N=null,b=null;E!==void 0&&(N=""+E),y.key!==void 0&&(N=""+y.key),y.ref!==void 0&&(b=y.ref);for(v in y)xs.call(y,v)&&!fs.hasOwnProperty(v)&&(f[v]=y[v]);if(I&&I.defaultProps)for(v in y=I.defaultProps,y)f[v]===void 0&&(f[v]=y[v]);return{$$typeof:ms,type:I,key:N,ref:b,props:f,_owner:gs.current}}V.Fragment=us;V.jsx=Ie;V.jsxs=Ie;Te.exports=V;var e=Te.exports,le={},Re=ss;le.createRoot=Re.createRoot,le.hydrateRoot=Re.hydrateRoot;const ps=()=>{const[I,y]=p.useState(null),[E,v]=p.useState([]),[f,N]=p.useState([]),[b,U]=p.useState(new Set),[k,q]=p.useState("upload"),[ne,re]=p.useState(""),[Me,J]=p.useState(new Map),[T,K]=p.useState(null),[j,Y]=p.useState(null),[B,ce]=p.useState(""),[O,de]=p.useState(80),[$,oe]=p.useState([]),[G,M]=p.useState(0),[Q,he]=p.useState(new Set),[Le,X]=p.useState(!1),[_,me]=p.useState("clusters"),[F,ue]=p.useState(80),[ke,xe]=p.useState(new Set),[P,ge]=p.useState([]),[w,L]=p.useState(new Set),[H,fe]=p.useState([]),[g,pe]=p.useState(null),[Oe,Z]=p.useState(!1),[bs,be]=p.useState(new Map),je="1.9.4",Ne=[{version:"1.9.4",date:"30 dÃ©cembre 2025",tag:"ACTUELLE",color:"green",title:"ContrÃ´le intÃ©gritÃ© + Boutons dynamiques + Recommencer header",items:["ContrÃ´le d'intÃ©gritÃ© 8 types restaurÃ© (v1.6.1)","Bouton Recommencer dÃ©placÃ© dans le header","Boutons sÃ©lection affichent la valeur dynamique du filtre","Affichage complet des dÃ©tails dans l'onglet IA","Modal intÃ©gritÃ© avec rapport dÃ©taillÃ©"]},{version:"1.9.3",date:"30 dÃ©cembre 2025",tag:null,color:"blue",title:"Onglet Ã€ supprimer + Bouton flottant + Tableau clusters",items:['Onglet "Ã€ supprimer" remplace "IsolÃ©s" avec filtrage strict',"CritÃ¨res: totalement isolÃ©s (sans famille) OU sans nom/prÃ©nom","Bouton flottant pour actions rapides sans scroller","Tableau clusters dÃ©taillÃ© avec 9 colonnes",'Action "Supprimer" distincte de "Fusionner"',"PrÃ©servation complÃ¨te algorithme anti-faux-positifs v1.9.2"]},{version:"1.9.2",date:"28 dÃ©cembre 2025",tag:null,color:"blue",title:"CORRECTION CRITIQUE : Algorithme anti-faux-positifs",items:["CORRECTION MAJEURE: Nom + Sexe ne suffisent plus pour Ãªtre doublon","Nouvelle rÃ¨gle: AU MOINS 1 critÃ¨re suffisant requis","CritÃ¨res suffisants: naissance, lieu, parents, conjoints, fratrie, dÃ©cÃ¨s, profession"]},{version:"1.8.7",date:"24 dÃ©cembre 2025",tag:null,color:"indigo",title:"Version complÃ¨te avec toutes les corrections",items:["SystÃ¨me onglets Clusters/Doublons simples","Scoring moyen des clusters avec jauges visuelles","Filtre pourcentage minimum pour clusters"]},{version:"1.8.6",date:"16 dÃ©cembre 2025",tag:null,color:"blue",title:"Corrections GEDCOM et gÃ©nÃ©ration HEAD/TRLR",items:["Correction gestion balises CONT/CONC multi-lignes","GÃ©nÃ©ration automatique en-tÃªte HEAD complet"]}],_e={jean:["jehan","johan","johannes","joan","jan"],marie:["maria","mary","marye","maryse"],pierre:["peter","petrus","perre","peire"],jacques:["jacob","jacobus","jacque","james"],franÃ§ois:["francois","franciscus","franz"],antoine:["anthoine","antonius","anthony"],catherine:["katherine","caterine","katarina"],marguerite:["margueritte","margareta","margaret"],anne:["anna","anne","hanne"],jeanne:["jehanne","johanna","jane"],guillaume:["william","wilhelmus","guilhem"],louis:["ludovic","ludovicus","lewis"],charles:["carolus","karl","carlo"],henri:["henry","henricus","heinrich"],nicolas:["nicolaus","nicholas","nicola"],philippe:["philip","philippus","filippo"],michel:["michael","michaelus","miguel"],joseph:["josephus","josef","giuseppe"],etienne:["estienne","stephanus","stephen"],laurent:["laurentius","lawrence","lorenzo"]},z=s=>s?s.replace(/^\d{5}\s+/,"").trim():"",ee=s=>{if(!s)return"";const t=s.toLowerCase().trim();for(const[i,n]of Object.entries(_e))if(t===i||n.includes(t))return i;return t},D=s=>{if(!s)return"0000";const t=ee(s),i=t.toUpperCase().replace(/[^A-Z]/g,"").replace(/[AEIOUYH]/g,"0").replace(/[BFPV]/g,"1").replace(/[CGJKQSXZ]/g,"2").replace(/[DT]/g,"3").replace(/[L]/g,"4").replace(/[MN]/g,"5").replace(/[R]/g,"6");return i.length===0?"0000":((t[0]?.toUpperCase()||"0")+i.substring(1).replace(/(.)\1+/g,"$1").replace(/0/g,"")).substring(0,4).padEnd(4,"0")},Fe=s=>{const t=s.split(`
`),i=[],n=new Map;let r=null,u=null,o=null,m=null;return t.forEach(d=>{const l=d.trim();if(r&&(l.startsWith("2 CONT ")||l.startsWith("2 CONC "))){const a=l.startsWith("2 CONT "),c=l.split(a?"2 CONT ":"2 CONC ")[1]||"",h=a?`
`:"";m==="NAME"&&r.names.length>0?r.names[r.names.length-1]+=h+c:m==="BIRT_DATE"?r.birth+=h+c:m==="BIRT_PLAC"?r.birthPlace+=h+c:m==="DEAT_DATE"?r.death+=h+c:m==="DEAT_PLAC"?r.deathPlace+=h+c:m==="OCCU"&&(r.occupation+=h+c);return}if(l.startsWith("0")&&l.includes("INDI")){r&&i.push(r);const a=l.match(/@([^@]+)@/);r={id:a?a[1]:l.split(" ")[1],names:[],birth:"",birthPlace:"",death:"",deathPlace:"",sex:"",parents:[],spouses:[],familyAsChild:null,familiesAsSpouse:[],occupation:"",religion:""},o=null,m=null}else if(l.startsWith("0")&&l.includes("FAM")){r&&(i.push(r),r=null);const a=l.match(/@([^@]+)@/),c=a?a[1]:l.split(" ")[1];u={id:c,husband:null,wife:null,children:[]},n.set(c,u),o=null}else if(r){if(l.includes("NAME")){const a=l.split("NAME")[1]?.trim();a&&(r.names.push(a),m="NAME")}else if(l.includes("SEX"))r.sex=l.split("SEX")[1]?.trim()||"";else if(l.startsWith("1 BIRT"))o="birth";else if(l.startsWith("1 DEAT"))o="death";else if(l.startsWith("1 OCCU"))r.occupation=l.split("OCCU")[1]?.trim()||"",m="OCCU";else if(o&&l.includes("DATE")){const a=l.split("DATE")[1]?.trim()||"";o==="birth"?(r.birth=a,m="BIRT_DATE"):o==="death"&&(r.death=a,m="DEAT_DATE")}else if(o&&l.includes("PLAC")){const a=z(l.split("PLAC")[1]?.trim()||"");o==="birth"?(r.birthPlace=a,m="BIRT_PLAC"):o==="death"&&(r.deathPlace=a,m="DEAT_PLAC")}else if(l.includes("FAMC")){const a=l.match(/@([^@]+)@/);a&&(r.familyAsChild=a[1])}else if(l.includes("FAMS")){const a=l.match(/@([^@]+)@/);a&&r.familiesAsSpouse.push(a[1])}}else if(u){if(l.includes("HUSB")){const a=l.match(/@([^@]+)@/);a&&(u.husband=a[1])}else if(l.includes("WIFE")){const a=l.match(/@([^@]+)@/);a&&(u.wife=a[1])}else if(l.includes("CHIL")){const a=l.match(/@([^@]+)@/);a&&u.children.push(a[1])}}}),r&&i.push(r),i.forEach(d=>{if(d.familyAsChild){const l=n.get(d.familyAsChild);l&&(l.husband&&d.parents.push(l.husband),l.wife&&d.parents.push(l.wife))}d.familiesAsSpouse.forEach(l=>{const a=n.get(l);a&&(a.husband&&a.husband!==d.id&&d.spouses.push(a.husband),a.wife&&a.wife!==d.id&&d.spouses.push(a.wife))})}),{people:i,families:n}},ze=(s,t)=>{const i=[];let n=0,r=0;const u=[],o=s.names[0]?.toLowerCase()||"",m=t.names[0]?.toLowerCase()||"";let d=!1;if((o||m)&&(r+=30,o&&m)){const c=ee(o.split(" ")[0]||o.split("/")[0]),h=ee(m.split(" ")[0]||m.split("/")[0]),x=o.split(" ").pop()?.replace(/\//g,"")||"",C=m.split(" ").pop()?.replace(/\//g,"")||"",S=D(c),A=D(h),R=D(x),ie=D(C);o===m?(n+=30,d=!0,i.push("âœ“ Noms identiques (+30/30)")):S===A&&R===ie?(n+=25,d=!0,i.push("âœ“ Noms phonÃ©tiquement identiques (+25/30)")):c===h&&R===ie?(n+=25,d=!0,i.push("âœ“ Variante prÃ©nom reconnue (+25/30)")):S===A||R===ie?(n+=20,d=!0,i.push("â‰ˆ PrÃ©nom ou nom similaire (+20/30)")):o.includes(m)||m.includes(o)?(n+=15,d=!0,i.push("â‰ˆ Noms partiellement similaires (+15/30)")):i.push("âœ— Noms diffÃ©rents (0/30)")}if((s.birth||t.birth)&&(r+=25,s.birth&&t.birth)){const c=s.birth.match(/\d{4}/),h=t.birth.match(/\d{4}/);if(s.birth===t.birth)n+=25,u.push("naissance_exacte"),i.push("âœ“ Dates naissance identiques (+25/25)");else if(c&&h){const x=Math.abs(parseInt(c[0])-parseInt(h[0]));x===0?(n+=20,u.push("annee_naissance"),i.push("âœ“ AnnÃ©es naissance identiques (+20/25)")):x<=2?(n+=12,u.push("annee_proche"),i.push("â‰ˆ AnnÃ©es naissance proches Â±2 ans (+12/25)")):x<=5?(n+=5,i.push("â‰ˆ AnnÃ©es naissance Ã©loignÃ©es Â±5 ans (+5/25)")):i.push("âœ— Dates naissance trop Ã©loignÃ©es (0/25)")}}if((s.sex||t.sex)&&(r+=15,s.sex&&t.sex))if(s.sex===t.sex)n+=15,i.push("âœ“ MÃªme sexe (+15/15)");else return i.push("âœ— Sexes diffÃ©rents (Ã‰LIMINATOIRE)"),{score:0,details:i,sufficientCriteria:[]};if((s.parents.length>0||t.parents.length>0)&&(r+=20,s.parents.length>0&&t.parents.length>0)){const c=s.parents.filter(h=>t.parents.includes(h));c.length===2?(n+=20,u.push("parents_2"),i.push("âœ“ 2 parents communs (+20/20)")):c.length===1?(n+=10,u.push("parent_1"),i.push("â‰ˆ 1 parent commun (+10/20)")):i.push("âœ— Parents diffÃ©rents (0/20)")}if(!(s.parents.length>0&&t.parents.length>0)&&(s.familyAsChild||t.familyAsChild)&&(r+=15,s.familyAsChild&&t.familyAsChild&&(s.familyAsChild===t.familyAsChild?(n+=15,u.push("fratrie"),i.push("âœ“ MÃªme fratrie (+15/15)")):i.push("âœ— Fratries diffÃ©rentes (0/15)"))),s.birthPlace||t.birthPlace){r+=10;const c=z(s.birthPlace)?.toLowerCase(),h=z(t.birthPlace)?.toLowerCase();c&&h&&(c===h?(n+=10,u.push("lieu_naissance"),i.push("âœ“ Lieux naissance identiques (+10/10)")):c.includes(h)||h.includes(c)?(n+=5,u.push("lieu_partiel"),i.push("â‰ˆ Lieux naissance similaires (+5/10)")):i.push("âœ— Lieux naissance diffÃ©rents (0/10)"))}if((s.spouses.length>0||t.spouses.length>0)&&(r+=8,s.spouses.length>0&&t.spouses.length>0&&(s.spouses.filter(h=>t.spouses.includes(h)).length>0?(n+=8,u.push("conjoints"),i.push("âœ“ Conjoints communs (+8/8)")):i.push("âœ— Conjoints diffÃ©rents (0/8)"))),(s.death||t.death)&&(r+=15,s.death&&t.death)){const c=s.death.match(/\d{4}/),h=t.death.match(/\d{4}/);s.death===t.death?(n+=15,u.push("deces_exact"),i.push("âœ“ Dates dÃ©cÃ¨s identiques (+15/15)")):c&&h&&c[0]===h[0]?(n+=10,u.push("annee_deces"),i.push("âœ“ AnnÃ©es dÃ©cÃ¨s identiques (+10/15)")):i.push("âœ— Dates dÃ©cÃ¨s diffÃ©rentes (0/15)")}(s.occupation||t.occupation)&&(r+=5,s.occupation&&t.occupation&&(s.occupation.toLowerCase()===t.occupation.toLowerCase()?(n+=5,u.push("profession"),i.push("âœ“ MÃªme profession (+5/5)")):i.push("âœ— Professions diffÃ©rentes (0/5)")));const a=r>0?Math.round(n/r*100):0;return d&&u.length===0?(i.unshift("âš ï¸ REJET: Nom seul insuffisant - aucun critÃ¨re confirmant"),{score:0,details:i,sufficientCriteria:u,rejected:!0,rejectionReason:"Nom + Sexe seuls ne suffisent pas."}):(i.unshift("ðŸ“Š Score: "+n+"/"+r+" points | CritÃ¨res suffisants: "+(u.length>0?u.join(", "):"AUCUN")),{score:a,details:i,sufficientCriteria:u})},Ue=s=>{const t=[],i=new Map,n=new Map,r=new Map;s.forEach(d=>{const a=(d.names[0]||"").toLowerCase().split(" "),c=a[0]||"",h=a[a.length-1]?.replace(/\//g,"")||"",x=D(c)+"-"+D(h);i.has(x)||i.set(x,[]),i.get(x).push(d);const C=d.birth?.match(/\d{4}/)?.[0];if(C){const S=parseInt(C);for(let A=S-5;A<=S+5;A++){const R=String(A);n.has(R)||n.set(R,[]),n.get(R).push(d)}}d.parents.forEach(S=>{r.has(S)||r.set(S,[]),r.get(S).push(d)})});const u=new Set,o=(d,l)=>{if(d.id===l.id)return;const a=d.id<l.id?d.id+"-"+l.id:l.id+"-"+d.id;if(u.has(a)||(u.add(a),d.sex&&l.sex&&d.sex!==l.sex))return;const c=d.birth?.match(/\d{4}/)?.[0],h=l.birth?.match(/\d{4}/)?.[0];if(c&&h&&Math.abs(parseInt(c)-parseInt(h))>10)return;const x=ze(d,l);x.rejected||x.score>=80&&t.push({person1:d,person2:l,similarity:Math.round(x.score),details:x.details,sufficientCriteria:x.sufficientCriteria,id:a})};s.forEach((d,l)=>{const c=(d.names[0]||"").toLowerCase().split(" "),h=c[0]||"",x=c[c.length-1]?.replace(/\//g,"")||"",C=D(h)+"-"+D(x);(i.get(C)||[]).forEach(A=>o(d,A));const S=d.birth?.match(/\d{4}/)?.[0];S&&(n.get(S)||[]).forEach(A=>o(d,A)),d.parents.forEach(A=>(r.get(A)||[]).forEach(R=>o(d,R))),l%100===0&&M(30+Math.round(l/s.length*65))});const m=t.sort((d,l)=>l.similarity-d.similarity);return qe(m,s),m},qe=(s,t)=>{const i=new Map,n=new Set,r=[];s.forEach(o=>{i.has(o.person1.id)||i.set(o.person1.id,new Set),i.has(o.person2.id)||i.set(o.person2.id,new Set),i.get(o.person1.id).add(o.person2.id),i.get(o.person2.id).add(o.person1.id)});const u=(o,m)=>{n.has(o)||(n.add(o),m.add(o),(i.get(o)||new Set).forEach(d=>u(d,m)))};i.forEach((o,m)=>{if(!n.has(m)){const d=new Set;if(u(m,d),d.size>2){const l=Array.from(d),a=l.map(c=>t.find(h=>h.id===c)).filter(c=>c!=null);if(a.length>2){const c=s.filter(x=>l.includes(x.person1.id)&&l.includes(x.person2.id)),h=c.length>0?Math.round(c.reduce((x,C)=>x+C.similarity,0)/c.length):0;r.push({ids:l,size:a.length,people:a,avgScore:h,pairs:c})}}}}),r.sort((o,m)=>m.avgScore-o.avgScore),oe(r)},Be=(s,t)=>{const i=[];return s.forEach(n=>{const r=n.parents.length>0,u=n.spouses.length>0;let o=!1;t.forEach(c=>{(c.husband===n.id||c.wife===n.id)&&c.children.length>0&&(o=!0)});const m=!r&&!o&&!u,a=(n.names[0]||"").replace(/\//g," ").trim().split(/\s+/).filter(c=>c.length>0).length===0;if(m||a){let c=m&&a?"IsolÃ© + Sans identitÃ©":m?"Totalement isolÃ©":"Sans identitÃ©";i.push({...n,isTotallyIsolated:m,hasNoIdentity:a,reason:c,hasSpouses:u,hasParents:r,hasChildren:o})}}),i},$e=s=>{const t=[],i=new Map;return s.forEach(n=>{const u=(n.names[0]||"").split(" ").pop()?.replace(/\//g,"").toLowerCase()||"",o=D(u);i.has(o)||i.set(o,[]),i.get(o).push(n)}),i.forEach(n=>{if(!(n.length<2))for(let r=0;r<n.length;r++)for(let u=r+1;u<n.length;u++){const o=n[r],m=n[u];if(o.sex&&m.sex&&o.sex!==m.sex)continue;const d=o.birth?.match(/\d{4}/)?.[0],l=m.birth?.match(/\d{4}/)?.[0];let a=d&&l?Math.abs(parseInt(d)-parseInt(l)):null;if(a===null||a<=25){const c=[];let h=60;a!==null&&a<=10&&(c.push("NÃ©s Ã  "+a+" ans d'Ã©cart"),h+=15),o.birthPlace&&m.birthPlace&&z(o.birthPlace).toLowerCase()===z(m.birthPlace).toLowerCase()&&(c.push("MÃªme lieu de naissance"),h+=10),o.parents.some(x=>m.parents.includes(x))&&(c.push("Parents communs"),h+=10),c.length>=2&&h>=60&&t.push({person1:o,person2:m,confidence:Math.min(h,95),reasons:c,type:"pattern_match"})}}}),t.sort((n,r)=>r.confidence-n.confidence),t.slice(0,50)},Ge=(s,t)=>{const i=[],n=[];let r=0,u=0;const o=new Set(s.map(a=>a.id));t.forEach((a,c)=>{if(a.husband&&o.has(a.husband)){const h=s.find(x=>x.id===a.husband);h&&!h.familiesAsSpouse.includes(c)&&n.push({type:"unidirectional_link",message:"Lien unidirectionnel: Famille "+c+" â†’ "+a.husband})}}),s.forEach(a=>{if(a.familyAsChild&&!t.has(a.familyAsChild)&&n.push({type:"structure_error",message:(a.names[0]||a.id)+": Saut de niveau - famille "+a.familyAsChild+" inexistante"}),(!a.names[0]||a.names[0].trim()==="")&&i.push({type:"no_name",message:a.id+": Sans nom"}),a.birth&&a.death){const x=a.birth.match(/\d{4}/)?.[0],C=a.death.match(/\d{4}/)?.[0];x&&C&&parseInt(x)>parseInt(C)&&i.push({type:"birth_after_death",message:(a.names[0]||a.id)+": Naissance aprÃ¨s dÃ©cÃ¨s"})}a.parents.forEach(x=>{o.has(x)||n.push({type:"orphan_reference",message:(a.names[0]||a.id)+": Parent "+x+" inexistant"})}),a.parents.length>0||a.spouses.length>0||a.familiesAsSpouse.length>0||r++;let h=0;a.names[0]&&(h+=2),a.birth&&(h+=2),a.death&&(h+=2),a.sex&&(h+=1),a.birthPlace&&(h+=1),a.parents.length>0&&(h+=2),u+=h});const m=(a,c=new Set)=>{if(c.has(a))return!0;const h=s.find(x=>x.id===a);if(!h)return!1;c.add(a);for(const x of h.parents)if(m(x,new Set(c)))return!0;return!1};s.slice(0,100).forEach(a=>{m(a.id)&&i.push({type:"genealogical_loop",message:(a.names[0]||a.id)+": Boucle gÃ©nÃ©alogique dÃ©tectÃ©e"})});const d={};s.forEach(a=>{d[a.id]=(d[a.id]||0)+1}),Object.entries(d).forEach(([a,c])=>{c>1&&i.push({type:"duplicate_id",message:"ID "+a+" dupliquÃ© "+c+" fois"})});const l=s.length>0?Math.round(u/(s.length*10)*100):0;return{errors:i,warnings:n,isolatedCount:r,completenessScore:l,errorCount:i.length,warningCount:n.length,totalChecked:s.length}},ye=s=>s.avgScore||0,se=()=>$.filter(s=>ye(s)>=F),He=()=>{const s=new Set;$.forEach((t,i)=>{ye(t)>=F&&s.add(i)}),xe(s)},We=s=>{const t=new Set(b);f.forEach(i=>{s.includes(i.person1.id)&&s.includes(i.person2.id)&&t.add(i.id)}),U(t)},Ve=s=>{const t=new Set(Q);t.has(s)?t.delete(s):t.add(s),he(t)},ve=s=>{let t=0;return s.names[0]?.length>5&&(t+=10),s.birth&&(t+=8),s.death&&(t+=6),s.sex&&(t+=4),s.birthPlace&&(t+=7),s.deathPlace&&(t+=5),t+=s.parents.length*6,t+=s.spouses.length*5,s.occupation&&(t+=4),s.familyAsChild&&(t+=3),t+=s.familiesAsSpouse.length*3,t},Je=s=>Y(s),te=()=>Y(null),we=s=>{const t=new Set(b);t.has(s)?t.delete(s):t.add(s),U(t)},Ke=()=>{const s=f.filter(t=>t.similarity>=O).map(t=>t.id);U(new Set(s))},Ce=s=>E.find(i=>i.id===s)?.names[0]||s,Ye=s=>{const t=s.target.files[0];if(t){y(t),M(5);const i=new FileReader;i.onload=n=>{const r=n.target.result;re(r),M(15);const{people:u,families:o}=Fe(r);M(30),v(u),be(o);const m=Ue(u);N(m);const d=Be(u,o);ge(d);const l=$e(u);fe(l);const a=Ge(u,o);pe(a),M(100),q("review")},i.readAsText(t)}},Qe=()=>{if(b.size===0)return;const s=new Map;f.forEach(i=>{if(b.has(i.id)){const n=ve(i.person1),r=ve(i.person2),u=n>=r?i.person1:i.person2,o=i.person1.id,m=i.person2.id;let d=u.id;s.has(o)?d=s.get(o):s.has(m)&&(d=s.get(m)),s.set(o,d),s.set(m,d)}}),J(s);const t=new Set;s.forEach((i,n)=>{n!==i&&t.add(n)}),K({totalIndividuals:E.length,mergedCount:t.size,deletedCount:0,remainingCount:E.length-t.size}),q("merged")},Xe=()=>{w.size!==0&&window.confirm("âš ï¸ Vous allez SUPPRIMER dÃ©finitivement "+w.size+` individu(s) de votre arbre.

Cette action est irrÃ©versible. Continuer ?`)&&(J(new Map),K({totalIndividuals:E.length,mergedCount:0,deletedCount:w.size,remainingCount:E.length-w.size}),q("merged"))},Ze=()=>{if(!ne)return;const s=new Set,t=new Map;Me.forEach((l,a)=>{a!==l&&(s.add(a),t.set(a,l))}),w.forEach(l=>s.add(l));const i=ne.split(`
`),n=[];let r=!1;if(!(i.length>0&&i[0].trim().startsWith("0 HEAD"))){n.push("0 HEAD","1 SOUR GedcomMerger","2 VERS "+je,"2 NAME Fusionneur de Doublons GEDCOM","1 GEDC","2 VERS 5.5.1","2 FORM LINEAGE-LINKED","1 CHAR UTF-8");const l=new Date,a=l.getDate()+" "+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][l.getMonth()]+" "+l.getFullYear();n.push("1 DATE "+a)}for(let l=0;l<i.length;l++){const a=i[l],c=a.trim();if(c.startsWith("0 TRLR"))continue;if(c.startsWith("0 ")&&(r=!1,c.includes("@"))){const x=c.match(/@([^@]+)@/);if(x&&s.has(x[1])){r=!0;continue}}if(r)continue;let h=a;t.forEach((x,C)=>{h=h.replace(new RegExp("@"+C+"@","g"),"@"+x+"@")}),n.push(h)}n.push("0 TRLR");const o=new Blob([n.join(`
`)],{type:"text/plain"}),m=URL.createObjectURL(o),d=document.createElement("a");d.href=m,d.download="gedcom_nettoye_"+new Date().toISOString().slice(0,10)+".ged",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m)},ae=()=>{q("upload"),v([]),N([]),U(new Set),re(""),ce(""),de(80),M(0),me("clusters"),ue(80),xe(new Set),oe([]),he(new Set),ge([]),L(new Set),fe([]),pe(null),y(null),J(new Map),K(null),Y(null),be(new Map)},es=()=>f.filter(s=>s.similarity>=O&&(!B||s.person1.names.some(t=>t.toLowerCase().includes(B.toLowerCase()))||s.person2.names.some(t=>t.toLowerCase().includes(B.toLowerCase())))),W=()=>{const s=new Set;return $.forEach(t=>t.ids.forEach(i=>s.add(i))),es().filter(t=>!s.has(t.person1.id)&&!s.has(t.person2.id))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-4 py-4 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Fusionneur GEDCOM"}),e.jsxs("p",{className:"text-emerald-100 text-sm",children:["v",je," - ContrÃ´le intÃ©gritÃ© + Boutons dynamiques"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k!=="upload"&&g&&e.jsxs("button",{onClick:()=>Z(!0),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"IntÃ©gritÃ©"}),g.errorCount>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-red-500 rounded-full text-xs",children:g.errorCount})]}),k!=="upload"&&e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Recommencer"})]}),e.jsxs("button",{onClick:()=>X(!0),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"NouveautÃ©s"})]})]})]})}),G>0&&G<100&&e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-300",style:{width:G+"%"}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[G,"%"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[k==="upload"&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(is,{className:"w-16 h-16 mx-auto text-emerald-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Importer votre fichier GEDCOM"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Glissez-dÃ©posez ou sÃ©lectionnez un fichier .ged"})]}),e.jsx("label",{className:"block",children:e.jsxs("div",{className:"border-2 border-dashed border-emerald-300 rounded-xl p-8 text-center cursor-pointer hover:border-emerald-500 hover:bg-emerald-50 transition-all",children:[e.jsx("input",{type:"file",accept:".ged,.gedcom",onChange:Ye,className:"hidden"}),e.jsx(ls,{className:"w-12 h-12 mx-auto text-emerald-400 mb-3"}),e.jsx("p",{className:"text-emerald-600 font-medium",children:"Cliquez pour sÃ©lectionner"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"ou glissez-dÃ©posez ici"})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"NouveautÃ© v1.9.3"]}),e.jsx("p",{className:"text-blue-700 text-sm mt-1",children:'Nouvel onglet "Ã€ supprimer" avec critÃ¨res stricts : individus totalement isolÃ©s (sans famille) ou sans identitÃ©. Bouton flottant pour actions rapides.'})]})]})}),k==="review"&&e.jsxs("div",{children:[g&&g.errors.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-red-800 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),g.errors.length," erreur(s) dÃ©tectÃ©e(s)"]}),e.jsx("ul",{className:"mt-2 text-sm text-red-700",children:g.errors.slice(0,5).map((s,t)=>e.jsxs("li",{children:["â€¢ ",s.message]},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:E.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Individus"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:$.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Clusters"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:W().length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Doublons"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:P.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Ã€ supprimer"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:H.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Suggestions IA"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border overflow-hidden",children:[e.jsx("div",{className:"flex border-b",children:[{id:"clusters",label:"Clusters",icon:"ðŸŸ ",count:se().length},{id:"pairs",label:"Doublons",icon:"ðŸ”µ",count:W().length},{id:"toDelete",label:"Ã€ supprimer",icon:"ðŸ—‘ï¸",count:P.length},{id:"ai",label:"Suggestions IA",icon:"ðŸŸ£",count:H.length}].map(s=>e.jsxs("button",{onClick:()=>me(s.id),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${_===s.id?"bg-emerald-50 text-emerald-700 border-b-2 border-emerald-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"mr-1",children:s.icon}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-gray-100 rounded-full text-xs",children:s.count})]},s.id))}),e.jsxs("div",{className:"p-4",children:[_==="clusters"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Score min:"}),e.jsx("input",{type:"range",min:"80",max:"100",value:F,onChange:s=>ue(parseInt(s.target.value)),className:"w-24"}),e.jsxs("span",{className:"text-sm font-medium",children:[F,"%"]})]}),e.jsxs("button",{onClick:He,className:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700",children:["SÃ©lectionner â‰¥",F,"%"]})]}),se().length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun cluster trouvÃ© avec ce filtre"}):e.jsx("div",{className:"space-y-3",children:se().map((s,t)=>e.jsxs("div",{className:`border rounded-lg p-3 ${ke.has(t)?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium",children:[s.size," personnes"]}),e.jsxs("span",{className:`px-2 py-0.5 rounded text-sm ${s.avgScore>=95?"bg-green-100 text-green-800":s.avgScore>=90?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:["Score: ",s.avgScore,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ve(t),className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 flex items-center gap-1",children:Q.has(t)?e.jsxs(e.Fragment,{children:["RÃ©duire ",e.jsx(ns,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["DÃ©tails ",e.jsx(rs,{className:"w-4 h-4"})]})}),e.jsx("button",{onClick:()=>We(s.ids),className:"px-3 py-1 text-sm bg-emerald-600 text-white rounded hover:bg-emerald-700",children:"SÃ©lectionner"})]})]}),Q.has(t)&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"#"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Nom complet"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Naissance"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Lieu"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"DÃ©cÃ¨s"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Sexe"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Parents"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Conjoints"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"ID"})]})}),e.jsx("tbody",{children:s.people.map((i,n)=>e.jsxs("tr",{className:n%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1 text-gray-500",children:n+1}),e.jsx("td",{className:"px-2 py-1 font-medium",children:i.names[0]||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.birth||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.birthPlace||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.death||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.sex||"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:i.parents.length>0?i.parents.map(r=>Ce(r)).join(", "):"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:i.spouses.length>0?i.spouses.map(r=>Ce(r)).join(", "):"-"}),e.jsx("td",{className:"px-2 py-1 text-xs text-gray-400",children:i.id})]},i.id))})]})}),e.jsxs("div",{className:"mt-2 pt-2 border-t text-xs text-gray-500 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["ðŸ“Š Avec naissance: ",s.people.filter(i=>i.birth).length,"/",s.size]}),e.jsxs("span",{children:["ðŸ“Š Avec dÃ©cÃ¨s: ",s.people.filter(i=>i.death).length,"/",s.size]}),e.jsxs("span",{children:["ðŸ“Š Paires liÃ©es: ",s.pairs?.length||0]})]})]})]},t))})]}),_==="pairs"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Rechercher par nom ou ID...",value:B,onChange:s=>ce(s.target.value),className:"px-3 py-2 border rounded-lg text-sm flex-1 min-w-[200px]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Score min:"}),e.jsx("input",{type:"range",min:"80",max:"100",value:O,onChange:s=>de(parseInt(s.target.value)),className:"w-24"}),e.jsxs("span",{className:"text-sm font-medium",children:[O,"%"]})]}),e.jsxs("button",{onClick:Ke,className:"px-3 py-1 bg-emerald-600 text-white text-sm rounded-lg hover:bg-emerald-700",children:["SÃ©lectionner â‰¥",O,"%"]})]}),W().length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun doublon simple trouvÃ©"}):e.jsx("div",{className:"space-y-2",children:W().slice(0,50).map(s=>e.jsxs("div",{className:`border rounded-lg p-3 ${b.has(s.id)?"border-emerald-500 bg-emerald-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.person1.names[0]||s.person1.id}),e.jsxs("div",{className:"text-sm text-gray-500",children:["â†” ",s.person2.names[0]||s.person2.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${s.similarity>=95?"bg-green-100 text-green-800":s.similarity>=90?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:[s.similarity,"%"]}),e.jsx("button",{onClick:()=>Je(s),className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"PrÃ©visualiser"}),e.jsx("button",{onClick:()=>we(s.id),className:`px-2 py-1 text-sm rounded ${b.has(s.id)?"bg-emerald-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:b.has(s.id)?"âœ“":"SÃ©lectionner"})]})]}),s.sufficientCriteria&&s.sufficientCriteria.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-emerald-600",children:["CritÃ¨res validants: ",s.sufficientCriteria.join(", ")]})]},s.id))})]}),_==="toDelete"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("button",{onClick:()=>L(new Set(P.map(s=>s.id))),className:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700",children:"Tout sÃ©lectionner"}),e.jsx("button",{onClick:()=>L(new Set(P.filter(s=>s.isTotallyIsolated).map(s=>s.id))),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700",children:"Totalement isolÃ©s"}),e.jsx("button",{onClick:()=>L(new Set(P.filter(s=>s.hasNoIdentity).map(s=>s.id))),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700",children:"Sans identitÃ©"}),e.jsx("button",{onClick:()=>L(new Set),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600",children:"DÃ©sÃ©lectionner tout"}),e.jsxs("span",{className:"text-sm text-gray-500 self-center",children:[w.size," sÃ©lectionnÃ©(s)"]})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Totalement isolÃ©s:"})," ",P.filter(s=>s.isTotallyIsolated).length,e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("span",{className:"font-medium",children:"Sans identitÃ©:"})," ",P.filter(s=>s.hasNoIdentity).length]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CritÃ¨res: totalement isolÃ© (sans parents, enfants, conjoints) OU sans nom/prÃ©nom"})]}),P.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun individu Ã  supprimer trouvÃ©"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P.map(s=>e.jsx("div",{className:`border rounded-lg p-3 ${w.has(s.id)?"border-red-500 bg-red-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.names[0]||"[ID: "+s.id+"]"}),e.jsx("div",{className:"flex gap-2 mt-1",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.reason==="IsolÃ© + Sans identitÃ©"?"bg-purple-100 text-purple-800":s.reason==="Totalement isolÃ©"?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"}`,children:s.reason})})]}),e.jsx("button",{onClick:()=>{const t=new Set(w);t.has(s.id)?t.delete(s.id):t.add(s.id),L(t)},className:`px-2 py-1 text-sm rounded ${w.has(s.id)?"bg-red-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:w.has(s.id)?"âœ“":"SÃ©lectionner"})]})},s.id))})]}),_==="ai"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800",children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Analyse de patterns"})]}),e.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"Ces suggestions sont basÃ©es sur l'analyse des noms, pÃ©riodes et lieux. VÃ©rifiez chaque suggestion avant de l'accepter."})]}),H.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune suggestion IA disponible"}):e.jsx("div",{className:"space-y-3",children:H.map((s,t)=>e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-purple-50/30",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${s.confidence>=90?"bg-green-100 text-green-800":s.confidence>=75?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:["Confiance: ",s.confidence,"%"]})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:s.person1.names[0]||s.person1.id}),e.jsxs("div",{className:"text-gray-500",children:["â†” ",s.person2.names[0]||s.person2.id]})]}),e.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:["Raisons: ",s.reasons.join(" â€¢ ")]})]},t))})]})]})]}),(b.size>0||w.size>0)&&e.jsxs("div",{className:"fixed bottom-6 right-6 flex flex-col gap-2 z-50",children:[b.size>0&&e.jsxs("button",{onClick:Qe,className:"px-6 py-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Fusionner ",b.size," doublon(s)"]}),w.size>0&&e.jsxs("button",{onClick:Xe,className:"px-6 py-3 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 font-medium flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),"Supprimer ",w.size," individu(s)"]})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:ae,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Recommencer"})})]}),k==="merged"&&T&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(De,{className:"w-16 h-16 mx-auto text-emerald-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Traitement terminÃ© !"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:T.totalIndividuals}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avant"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["-",T.mergedCount+T.deletedCount]}),e.jsx("div",{className:"text-sm text-gray-500",children:T.mergedCount>0&&T.deletedCount>0?"FusionnÃ©s + SupprimÃ©s":T.mergedCount>0?"FusionnÃ©s":"SupprimÃ©s"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:T.remainingCount}),e.jsx("div",{className:"text-sm text-gray-500",children:"AprÃ¨s"})]})]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:Ze,className:"w-full px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-medium flex items-center justify-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"}),"TÃ©lÃ©charger le fichier nettoyÃ©"]}),e.jsx("button",{onClick:ae,className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Traiter un autre fichier"})]})]})})]}),Le&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ee,{className:"w-6 h-6"}),"Historique des versions"]}),e.jsx("button",{onClick:()=>X(!1),className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:Ne.map((s,t)=>e.jsxs("div",{className:`mb-6 pb-6 ${t<Ne.length-1?"border-b":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${s.color}-100 text-${s.color}-800`,children:["v",s.version]}),s.tag&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${s.tag==="ACTUELLE"?"bg-green-500 text-white":"bg-gray-200"}`,children:s.tag}),e.jsx("span",{className:"text-sm text-gray-500",children:s.date})]}),e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:s.title}),e.jsx("ul",{className:"space-y-1",children:s.items.map((i,n)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-500 mt-1",children:"â€¢"}),e.jsx("span",{children:i})]},n))})]},t))}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t",children:e.jsx("button",{onClick:()=>X(!1),className:"w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:"Fermer"})})]})}),Oe&&g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:`sticky top-0 px-6 py-4 ${g.errorCount>0?"bg-red-600":g.warningCount>0?"bg-yellow-600":"bg-green-600"} text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ae,{className:"w-6 h-6"}),"Rapport d'intÃ©gritÃ©"]}),e.jsx("button",{onClick:()=>Z(!1),className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:g.totalChecked}),e.jsx("div",{className:"text-sm text-gray-500",children:"Individus analysÃ©s"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.errorCount}),e.jsx("div",{className:"text-sm text-red-500",children:"Erreurs"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:g.warningCount}),e.jsx("div",{className:"text-sm text-yellow-500",children:"Avertissements"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[g.completenessScore,"%"]}),e.jsx("div",{className:"text-sm text-blue-500",children:"ComplÃ©tude"})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Personnes isolÃ©es:"})," ",g.isolatedCount]})}),g.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"font-semibold text-red-800 mb-2",children:["Erreurs (",g.errors.length,")"]}),e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:[g.errors.slice(0,20).map((s,t)=>e.jsxs("div",{className:"text-sm p-2 bg-red-50 rounded text-red-700",children:["â€¢ ",s.message]},t)),g.errors.length>20&&e.jsxs("p",{className:"text-sm text-gray-500",children:["... et ",g.errors.length-20," autres erreurs"]})]})]}),g.warnings.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-yellow-800 mb-2",children:["Avertissements (",g.warnings.length,")"]}),e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:[g.warnings.slice(0,20).map((s,t)=>e.jsxs("div",{className:"text-sm p-2 bg-yellow-50 rounded text-yellow-700",children:["â€¢ ",s.message]},t)),g.warnings.length>20&&e.jsxs("p",{className:"text-sm text-gray-500",children:["... et ",g.warnings.length-20," autres avertissements"]})]})]}),g.errorCount===0&&g.warningCount===0&&e.jsxs("div",{className:"text-center py-8 text-green-600",children:[e.jsx(De,{className:"w-16 h-16 mx-auto mb-4"}),e.jsx("p",{className:"font-semibold",children:"Aucun problÃ¨me dÃ©tectÃ© !"})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t",children:e.jsx("button",{onClick:()=>Z(!1),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Fermer"})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"sticky top-0 bg-emerald-600 text-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"PrÃ©visualisation de la fusion"}),e.jsx("button",{onClick:te,className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:j.person1.names[0]||j.person1.id}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600",children:[e.jsxs("p",{children:["ID: ",j.person1.id]}),e.jsxs("p",{children:["Naissance: ",j.person1.birth||"N/A"]}),e.jsxs("p",{children:["Lieu: ",j.person1.birthPlace||"N/A"]}),e.jsxs("p",{children:["DÃ©cÃ¨s: ",j.person1.death||"N/A"]}),e.jsxs("p",{children:["Sexe: ",j.person1.sex||"N/A"]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:j.person2.names[0]||j.person2.id}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600",children:[e.jsxs("p",{children:["ID: ",j.person2.id]}),e.jsxs("p",{children:["Naissance: ",j.person2.birth||"N/A"]}),e.jsxs("p",{children:["Lieu: ",j.person2.birthPlace||"N/A"]}),e.jsxs("p",{children:["DÃ©cÃ¨s: ",j.person2.death||"N/A"]}),e.jsxs("p",{children:["Sexe: ",j.person2.sex||"N/A"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"DÃ©tails de la comparaison"}),e.jsx("div",{className:"text-sm space-y-1",children:j.details.map((s,t)=>e.jsx("p",{className:"text-gray-600",children:s},t))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t flex gap-3",children:[e.jsx("button",{onClick:te,className:"flex-1 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Fermer"}),e.jsx("button",{onClick:()=>{we(j.id),te()},className:`flex-1 px-4 py-2 rounded-lg ${b.has(j.id)?"bg-red-500 text-white hover:bg-red-600":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:b.has(j.id)?"DÃ©sÃ©lectionner":"SÃ©lectionner pour fusion"})]})]})})]})};le.createRoot(document.getElementById("root")).render(e.jsx(ts.StrictMode,{children:e.jsx(ps,{})}));
