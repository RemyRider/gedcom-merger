import{r as b,a as ss,R as ts}from"./react-vendor-DghaKJPf.js";import{U as Se,S as Ae,R as is,a as Ee,b as as,F as ns,A as Pe,C as ls,c as rs,B as cs,T as ds,d as De,D as os}from"./lucide-DVQiqCb7.js";(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))v(g);new MutationObserver(g=>{for(const N of g)if(N.type==="childList")for(const j of N.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&v(j)}).observe(document,{childList:!0,subtree:!0});function E(g){const N={};return g.integrity&&(N.integrity=g.integrity),g.referrerPolicy&&(N.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?N.credentials="include":g.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function v(g){if(g.ep)return;g.ep=!0;const N=E(g);fetch(g.href,N)}})();var Te={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ms=b,hs=Symbol.for("react.element"),xs=Symbol.for("react.fragment"),us=Object.prototype.hasOwnProperty,ps=ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fs={key:!0,ref:!0,__self:!0,__source:!0};function Le(M,y,E){var v,g={},N=null,j=null;E!==void 0&&(N=""+E),y.key!==void 0&&(N=""+y.key),y.ref!==void 0&&(j=y.ref);for(v in y)us.call(y,v)&&!fs.hasOwnProperty(v)&&(g[v]=y[v]);if(M&&M.defaultProps)for(v in y=M.defaultProps,y)g[v]===void 0&&(g[v]=y[v]);return{$$typeof:hs,type:M,key:N,ref:j,props:g,_owner:ps.current}}J.Fragment=xs;J.jsx=Le;J.jsxs=Le;Te.exports=J;var e=Te.exports,ce={},Re=ss;ce.createRoot=Re.createRoot,ce.hydrateRoot=Re.hydrateRoot;const gs=()=>{const[M,y]=b.useState(null),[E,v]=b.useState([]),[g,N]=b.useState([]),[j,_]=b.useState(new Set),[F,q]=b.useState("upload"),[de,oe]=b.useState(""),[Ie,K]=b.useState(new Map),[L,Y]=b.useState(null),[m,Q]=b.useState(null),[$,me]=b.useState(""),[z,he]=b.useState(80),[W,xe]=b.useState([]),[G,k]=b.useState(0),[X,ue]=b.useState(new Set),[Me,Z]=b.useState(!1),[U,pe]=b.useState("clusters"),[B,fe]=b.useState(80),[ke,ee]=b.useState(new Set),[P,ge]=b.useState([]),[w,O]=b.useState(new Set),[H,be]=b.useState([]),[f,je]=b.useState(null),[Oe,se]=b.useState(!1),[bs,Ne]=b.useState(new Map),ye="1.9.5",te=[{version:"1.9.5",date:"31 dÃ©cembre 2025",tag:"ACTUELLE",color:"green",title:"DÃ©tails complets + Boutons dÃ©sÃ©lection + Parsing Ã©tendu",items:["Affichage de TOUS les champs parsÃ©s (ID, sexe, profession, religion, lieux dÃ©cÃ¨s...)",'Boutons "DÃ©sÃ©lectionner tout" sur onglets Clusters et Doublons',"Parsing Ã©tendu: baptÃªme, inhumation, rÃ©sidence, titre, notes","Algo amÃ©liorÃ©: lieu de dÃ©cÃ¨s, enfants communs comme critÃ¨res","Sous-titre dynamique basÃ© sur la version actuelle","236 tests anti-rÃ©gression prÃ©servÃ©s"]},{version:"1.9.4",date:"30 dÃ©cembre 2025",tag:null,color:"blue",title:"ContrÃ´le intÃ©gritÃ© + Boutons dynamiques + Recommencer header",items:["ContrÃ´le d'intÃ©gritÃ© 8 types restaurÃ© (v1.6.1)","Bouton Recommencer dÃ©placÃ© dans le header","Boutons sÃ©lection affichent la valeur dynamique du filtre","Affichage complet des dÃ©tails dans l'onglet IA","Modal intÃ©gritÃ© avec rapport dÃ©taillÃ©"]},{version:"1.9.3",date:"30 dÃ©cembre 2025",tag:null,color:"blue",title:"Onglet Ã€ supprimer + Bouton flottant + Tableau clusters",items:['Onglet "Ã€ supprimer" remplace "IsolÃ©s" avec filtrage strict',"CritÃ¨res: totalement isolÃ©s (sans famille) OU sans nom/prÃ©nom","Bouton flottant pour actions rapides sans scroller","Tableau clusters dÃ©taillÃ© avec 9 colonnes",'Action "Supprimer" distincte de "Fusionner"',"PrÃ©servation complÃ¨te algorithme anti-faux-positifs v1.9.2"]},{version:"1.9.2",date:"28 dÃ©cembre 2025",tag:null,color:"blue",title:"CORRECTION CRITIQUE : Algorithme anti-faux-positifs",items:["CORRECTION MAJEURE: Nom + Sexe ne suffisent plus pour Ãªtre doublon","Nouvelle rÃ¨gle: AU MOINS 1 critÃ¨re suffisant requis","CritÃ¨res suffisants: naissance, lieu, parents, conjoints, fratrie, dÃ©cÃ¨s, profession"]},{version:"1.8.7",date:"24 dÃ©cembre 2025",tag:null,color:"indigo",title:"Version complÃ¨te avec toutes les corrections",items:["SystÃ¨me onglets Clusters/Doublons simples","Scoring moyen des clusters avec jauges visuelles","Filtre pourcentage minimum pour clusters"]},{version:"1.8.6",date:"16 dÃ©cembre 2025",tag:null,color:"blue",title:"Corrections GEDCOM et gÃ©nÃ©ration HEAD/TRLR",items:["Correction gestion balises CONT/CONC multi-lignes","GÃ©nÃ©ration automatique en-tÃªte HEAD complet"]}],_e={jean:["jehan","johan","johannes","joan","jan"],marie:["maria","mary","marye","maryse"],pierre:["peter","petrus","perre","peire"],jacques:["jacob","jacobus","jacque","james"],franÃ§ois:["francois","franciscus","franz"],antoine:["anthoine","antonius","anthony"],catherine:["katherine","caterine","katarina"],marguerite:["margueritte","margareta","margaret"],anne:["anna","anne","hanne"],jeanne:["jehanne","johanna","jane"],guillaume:["william","wilhelmus","guilhem"],louis:["ludovic","ludovicus","lewis"],charles:["carolus","karl","carlo"],henri:["henry","henricus","heinrich"],nicolas:["nicolaus","nicholas","nicola"],philippe:["philip","philippus","filippo"],michel:["michael","michaelus","miguel"],joseph:["josephus","josef","giuseppe"],etienne:["estienne","stephanus","stephen"],laurent:["laurentius","lawrence","lorenzo"]},I=s=>s?s.replace(/^\d{5}\s+/,"").trim():"",ie=s=>{if(!s)return"";const i=s.toLowerCase().trim();for(const[t,c]of Object.entries(_e))if(i===t||c.includes(i))return t;return i},D=s=>{if(!s)return"0000";const i=ie(s),t=i.toUpperCase().replace(/[^A-Z]/g,"").replace(/[AEIOUYH]/g,"0").replace(/[BFPV]/g,"1").replace(/[CGJKQSXZ]/g,"2").replace(/[DT]/g,"3").replace(/[L]/g,"4").replace(/[MN]/g,"5").replace(/[R]/g,"6");return t.length===0?"0000":((i[0]?.toUpperCase()||"0")+t.substring(1).replace(/(.)\1+/g,"$1").replace(/0/g,"")).substring(0,4).padEnd(4,"0")},Fe=s=>{const i=s.split(`
`),t=[],c=new Map;let l=null,u=null,d=null,x=null;return i.forEach(o=>{const n=o.trim();if(l&&(n.startsWith("2 CONT ")||n.startsWith("2 CONC "))){const a=n.startsWith("2 CONT "),r=n.split(a?"2 CONT ":"2 CONC ")[1]||"",h=a?`
`:"";x==="NAME"&&l.names.length>0?l.names[l.names.length-1]+=h+r:x==="BIRT_DATE"?l.birth+=h+r:x==="BIRT_PLAC"?l.birthPlace+=h+r:x==="DEAT_DATE"?l.death+=h+r:x==="DEAT_PLAC"?l.deathPlace+=h+r:x==="OCCU"&&(l.occupation+=h+r);return}if(n.startsWith("0")&&n.includes("INDI")){l&&t.push(l);const a=n.match(/@([^@]+)@/);l={id:a?a[1]:n.split(" ")[1],names:[],birth:"",birthPlace:"",death:"",deathPlace:"",sex:"",parents:[],spouses:[],familyAsChild:null,familiesAsSpouse:[],occupation:"",religion:"",baptism:"",baptismPlace:"",burial:"",burialPlace:"",residence:"",title:"",note:"",children:[]},d=null,x=null}else if(n.startsWith("0")&&n.includes("FAM")){l&&(t.push(l),l=null);const a=n.match(/@([^@]+)@/),r=a?a[1]:n.split(" ")[1];u={id:r,husband:null,wife:null,children:[]},c.set(r,u),d=null}else if(l){if(n.includes("NAME")){const a=n.split("NAME")[1]?.trim();a&&(l.names.push(a),x="NAME")}else if(n.includes("SEX"))l.sex=n.split("SEX")[1]?.trim()||"";else if(n.startsWith("1 BIRT"))d="birth";else if(n.startsWith("1 DEAT"))d="death";else if(n.startsWith("1 BAPM")||n.startsWith("1 CHR"))d="baptism";else if(n.startsWith("1 BURI")||n.startsWith("1 CREM"))d="burial";else if(n.startsWith("1 RESI"))d="residence";else if(n.startsWith("1 OCCU"))l.occupation=n.split("OCCU")[1]?.trim()||"",x="OCCU";else if(n.startsWith("1 TITL"))l.title=n.split("TITL")[1]?.trim()||"";else if(n.startsWith("1 RELI"))l.religion=n.split("RELI")[1]?.trim()||"";else if(n.startsWith("1 NOTE"))l.note=n.split("NOTE")[1]?.trim()||"";else if(d&&n.includes("DATE")){const a=n.split("DATE")[1]?.trim()||"";d==="birth"?(l.birth=a,x="BIRT_DATE"):d==="death"?(l.death=a,x="DEAT_DATE"):d==="baptism"?l.baptism=a:d==="burial"&&(l.burial=a)}else if(d&&n.includes("PLAC")){const a=I(n.split("PLAC")[1]?.trim()||"");d==="birth"?(l.birthPlace=a,x="BIRT_PLAC"):d==="death"?(l.deathPlace=a,x="DEAT_PLAC"):d==="baptism"?l.baptismPlace=a:d==="burial"?l.burialPlace=a:d==="residence"&&(l.residence=a)}else if(n.includes("FAMC")){const a=n.match(/@([^@]+)@/);a&&(l.familyAsChild=a[1])}else if(n.includes("FAMS")){const a=n.match(/@([^@]+)@/);a&&l.familiesAsSpouse.push(a[1])}}else if(u){if(n.includes("HUSB")){const a=n.match(/@([^@]+)@/);a&&(u.husband=a[1])}else if(n.includes("WIFE")){const a=n.match(/@([^@]+)@/);a&&(u.wife=a[1])}else if(n.includes("CHIL")){const a=n.match(/@([^@]+)@/);a&&u.children.push(a[1])}}}),l&&t.push(l),t.forEach(o=>{if(o.familyAsChild){const n=c.get(o.familyAsChild);n&&(n.husband&&o.parents.push(n.husband),n.wife&&o.parents.push(n.wife))}o.familiesAsSpouse.forEach(n=>{const a=c.get(n);a&&(a.husband&&a.husband!==o.id&&o.spouses.push(a.husband),a.wife&&a.wife!==o.id&&o.spouses.push(a.wife),a.children.forEach(r=>{o.children.includes(r)||o.children.push(r)}))})}),{people:t,families:c}},ze=(s,i)=>{const t=[];let c=0,l=0;const u=[],d=s.names[0]?.toLowerCase()||"",x=i.names[0]?.toLowerCase()||"";let o=!1;if((d||x)&&(l+=30,d&&x)){const r=ie(d.split(" ")[0]||d.split("/")[0]),h=ie(x.split(" ")[0]||x.split("/")[0]),p=d.split(" ").pop()?.replace(/\//g,"")||"",C=x.split(" ").pop()?.replace(/\//g,"")||"",S=D(r),A=D(h),T=D(p),re=D(C);d===x?(c+=30,o=!0,t.push("âœ“ Noms identiques (+30/30)")):S===A&&T===re?(c+=25,o=!0,t.push("âœ“ Noms phonÃ©tiquement identiques (+25/30)")):r===h&&T===re?(c+=25,o=!0,t.push("âœ“ Variante prÃ©nom reconnue (+25/30)")):S===A||T===re?(c+=20,o=!0,t.push("â‰ˆ PrÃ©nom ou nom similaire (+20/30)")):d.includes(x)||x.includes(d)?(c+=15,o=!0,t.push("â‰ˆ Noms partiellement similaires (+15/30)")):t.push("âœ— Noms diffÃ©rents (0/30)")}if((s.birth||i.birth)&&(l+=25,s.birth&&i.birth)){const r=s.birth.match(/\d{4}/),h=i.birth.match(/\d{4}/);if(s.birth===i.birth)c+=25,u.push("naissance_exacte"),t.push("âœ“ Dates naissance identiques (+25/25)");else if(r&&h){const p=Math.abs(parseInt(r[0])-parseInt(h[0]));p===0?(c+=20,u.push("annee_naissance"),t.push("âœ“ AnnÃ©es naissance identiques (+20/25)")):p<=2?(c+=12,u.push("annee_proche"),t.push("â‰ˆ AnnÃ©es naissance proches Â±2 ans (+12/25)")):p<=5?(c+=5,t.push("â‰ˆ AnnÃ©es naissance Ã©loignÃ©es Â±5 ans (+5/25)")):t.push("âœ— Dates naissance trop Ã©loignÃ©es (0/25)")}}if((s.sex||i.sex)&&(l+=15,s.sex&&i.sex))if(s.sex===i.sex)c+=15,t.push("âœ“ MÃªme sexe (+15/15)");else return t.push("âœ— Sexes diffÃ©rents (Ã‰LIMINATOIRE)"),{score:0,details:t,sufficientCriteria:[]};if((s.parents.length>0||i.parents.length>0)&&(l+=20,s.parents.length>0&&i.parents.length>0)){const r=s.parents.filter(h=>i.parents.includes(h));r.length===2?(c+=20,u.push("parents_2"),t.push("âœ“ 2 parents communs (+20/20)")):r.length===1?(c+=10,u.push("parent_1"),t.push("â‰ˆ 1 parent commun (+10/20)")):t.push("âœ— Parents diffÃ©rents (0/20)")}if(!(s.parents.length>0&&i.parents.length>0)&&(s.familyAsChild||i.familyAsChild)&&(l+=15,s.familyAsChild&&i.familyAsChild&&(s.familyAsChild===i.familyAsChild?(c+=15,u.push("fratrie"),t.push("âœ“ MÃªme fratrie (+15/15)")):t.push("âœ— Fratries diffÃ©rentes (0/15)"))),s.birthPlace||i.birthPlace){l+=10;const r=I(s.birthPlace)?.toLowerCase(),h=I(i.birthPlace)?.toLowerCase();r&&h&&(r===h?(c+=10,u.push("lieu_naissance"),t.push("âœ“ Lieux naissance identiques (+10/10)")):r.includes(h)||h.includes(r)?(c+=5,u.push("lieu_partiel"),t.push("â‰ˆ Lieux naissance similaires (+5/10)")):t.push("âœ— Lieux naissance diffÃ©rents (0/10)"))}if((s.spouses.length>0||i.spouses.length>0)&&(l+=8,s.spouses.length>0&&i.spouses.length>0&&(s.spouses.filter(h=>i.spouses.includes(h)).length>0?(c+=8,u.push("conjoints"),t.push("âœ“ Conjoints communs (+8/8)")):t.push("âœ— Conjoints diffÃ©rents (0/8)"))),(s.death||i.death)&&(l+=15,s.death&&i.death)){const r=s.death.match(/\d{4}/),h=i.death.match(/\d{4}/);s.death===i.death?(c+=15,u.push("deces_exact"),t.push("âœ“ Dates dÃ©cÃ¨s identiques (+15/15)")):r&&h&&r[0]===h[0]?(c+=10,u.push("annee_deces"),t.push("âœ“ AnnÃ©es dÃ©cÃ¨s identiques (+10/15)")):t.push("âœ— Dates dÃ©cÃ¨s diffÃ©rentes (0/15)")}if((s.occupation||i.occupation)&&(l+=5,s.occupation&&i.occupation&&(s.occupation.toLowerCase()===i.occupation.toLowerCase()?(c+=5,u.push("profession"),t.push("âœ“ MÃªme profession (+5/5)")):t.push("âœ— Professions diffÃ©rentes (0/5)"))),s.deathPlace||i.deathPlace){l+=8;const r=I(s.deathPlace)?.toLowerCase(),h=I(i.deathPlace)?.toLowerCase();r&&h&&(r===h?(c+=8,u.push("lieu_deces"),t.push("âœ“ Lieux dÃ©cÃ¨s identiques (+8/8)")):r.includes(h)||h.includes(r)?(c+=4,u.push("lieu_deces_partiel"),t.push("â‰ˆ Lieux dÃ©cÃ¨s similaires (+4/8)")):t.push("âœ— Lieux dÃ©cÃ¨s diffÃ©rents (0/8)"))}if((s.children.length>0||i.children.length>0)&&(l+=15,s.children.length>0&&i.children.length>0)){const r=s.children.filter(h=>i.children.includes(h));r.length>=2?(c+=15,u.push("enfants_2+"),t.push("âœ“ 2+ enfants communs (+15/15)")):r.length===1?(c+=10,u.push("enfant_1"),t.push("â‰ˆ 1 enfant commun (+10/15)")):t.push("âœ— Enfants diffÃ©rents (0/15)")}const a=l>0?Math.round(c/l*100):0;return o&&u.length===0?(t.unshift("âš ï¸ REJET: Nom seul insuffisant - aucun critÃ¨re confirmant"),{score:0,details:t,sufficientCriteria:u,rejected:!0,rejectionReason:"Nom + Sexe seuls ne suffisent pas."}):(t.unshift("ðŸ“Š Score: "+c+"/"+l+" points | CritÃ¨res suffisants: "+(u.length>0?u.join(", "):"AUCUN")),{score:a,details:t,sufficientCriteria:u})},Ue=s=>{const i=[],t=new Map,c=new Map,l=new Map;s.forEach(o=>{const a=(o.names[0]||"").toLowerCase().split(" "),r=a[0]||"",h=a[a.length-1]?.replace(/\//g,"")||"",p=D(r)+"-"+D(h);t.has(p)||t.set(p,[]),t.get(p).push(o);const C=o.birth?.match(/\d{4}/)?.[0];if(C){const S=parseInt(C);for(let A=S-5;A<=S+5;A++){const T=String(A);c.has(T)||c.set(T,[]),c.get(T).push(o)}}o.parents.forEach(S=>{l.has(S)||l.set(S,[]),l.get(S).push(o)})});const u=new Set,d=(o,n)=>{if(o.id===n.id)return;const a=o.id<n.id?o.id+"-"+n.id:n.id+"-"+o.id;if(u.has(a)||(u.add(a),o.sex&&n.sex&&o.sex!==n.sex))return;const r=o.birth?.match(/\d{4}/)?.[0],h=n.birth?.match(/\d{4}/)?.[0];if(r&&h&&Math.abs(parseInt(r)-parseInt(h))>10)return;const p=ze(o,n);p.rejected||p.score>=80&&i.push({person1:o,person2:n,similarity:Math.round(p.score),details:p.details,sufficientCriteria:p.sufficientCriteria,id:a})};s.forEach((o,n)=>{const r=(o.names[0]||"").toLowerCase().split(" "),h=r[0]||"",p=r[r.length-1]?.replace(/\//g,"")||"",C=D(h)+"-"+D(p);(t.get(C)||[]).forEach(A=>d(o,A));const S=o.birth?.match(/\d{4}/)?.[0];S&&(c.get(S)||[]).forEach(A=>d(o,A)),o.parents.forEach(A=>(l.get(A)||[]).forEach(T=>d(o,T))),n%100===0&&k(30+Math.round(n/s.length*65))});const x=i.sort((o,n)=>n.similarity-o.similarity);return Be(x,s),x},Be=(s,i)=>{const t=new Map,c=new Set,l=[];s.forEach(d=>{t.has(d.person1.id)||t.set(d.person1.id,new Set),t.has(d.person2.id)||t.set(d.person2.id,new Set),t.get(d.person1.id).add(d.person2.id),t.get(d.person2.id).add(d.person1.id)});const u=(d,x)=>{c.has(d)||(c.add(d),x.add(d),(t.get(d)||new Set).forEach(o=>u(o,x)))};t.forEach((d,x)=>{if(!c.has(x)){const o=new Set;if(u(x,o),o.size>2){const n=Array.from(o),a=n.map(r=>i.find(h=>h.id===r)).filter(r=>r!=null);if(a.length>2){const r=s.filter(p=>n.includes(p.person1.id)&&n.includes(p.person2.id)),h=r.length>0?Math.round(r.reduce((p,C)=>p+C.similarity,0)/r.length):0;l.push({ids:n,size:a.length,people:a,avgScore:h,pairs:r})}}}}),l.sort((d,x)=>x.avgScore-d.avgScore),xe(l)},qe=(s,i)=>{const t=[];return s.forEach(c=>{const l=c.parents.length>0,u=c.spouses.length>0;let d=!1;i.forEach(r=>{(r.husband===c.id||r.wife===c.id)&&r.children.length>0&&(d=!0)});const x=!l&&!d&&!u,a=(c.names[0]||"").replace(/\//g," ").trim().split(/\s+/).filter(r=>r.length>0).length===0;if(x||a){let r=x&&a?"IsolÃ© + Sans identitÃ©":x?"Totalement isolÃ©":"Sans identitÃ©";t.push({...c,isTotallyIsolated:x,hasNoIdentity:a,reason:r,hasSpouses:u,hasParents:l,hasChildren:d})}}),t},$e=s=>{const i=[],t=new Map;return s.forEach(c=>{const u=(c.names[0]||"").split(" ").pop()?.replace(/\//g,"").toLowerCase()||"",d=D(u);t.has(d)||t.set(d,[]),t.get(d).push(c)}),t.forEach(c=>{if(!(c.length<2))for(let l=0;l<c.length;l++)for(let u=l+1;u<c.length;u++){const d=c[l],x=c[u];if(d.sex&&x.sex&&d.sex!==x.sex)continue;const o=d.birth?.match(/\d{4}/)?.[0],n=x.birth?.match(/\d{4}/)?.[0];let a=o&&n?Math.abs(parseInt(o)-parseInt(n)):null;if(a===null||a<=25){const r=[];let h=60;a!==null&&a<=10&&(r.push("NÃ©s Ã  "+a+" ans d'Ã©cart"),h+=15),d.birthPlace&&x.birthPlace&&I(d.birthPlace).toLowerCase()===I(x.birthPlace).toLowerCase()&&(r.push("MÃªme lieu de naissance"),h+=10),d.parents.some(p=>x.parents.includes(p))&&(r.push("Parents communs"),h+=10),r.length>=2&&h>=60&&i.push({person1:d,person2:x,confidence:Math.min(h,95),reasons:r,type:"pattern_match"})}}}),i.sort((c,l)=>l.confidence-c.confidence),i.slice(0,50)},We=(s,i)=>{const t=[],c=[];let l=0,u=0;const d=new Set(s.map(a=>a.id));i.forEach((a,r)=>{if(a.husband&&d.has(a.husband)){const h=s.find(p=>p.id===a.husband);h&&!h.familiesAsSpouse.includes(r)&&c.push({type:"unidirectional_link",message:"Lien unidirectionnel: Famille "+r+" â†’ "+a.husband})}}),s.forEach(a=>{if(a.familyAsChild&&!i.has(a.familyAsChild)&&c.push({type:"structure_error",message:(a.names[0]||a.id)+": Saut de niveau - famille "+a.familyAsChild+" inexistante"}),(!a.names[0]||a.names[0].trim()==="")&&t.push({type:"no_name",message:a.id+": Sans nom"}),a.birth&&a.death){const p=a.birth.match(/\d{4}/)?.[0],C=a.death.match(/\d{4}/)?.[0];p&&C&&parseInt(p)>parseInt(C)&&t.push({type:"birth_after_death",message:(a.names[0]||a.id)+": Naissance aprÃ¨s dÃ©cÃ¨s"})}a.parents.forEach(p=>{d.has(p)||c.push({type:"orphan_reference",message:(a.names[0]||a.id)+": Parent "+p+" inexistant"})}),a.parents.length>0||a.spouses.length>0||a.familiesAsSpouse.length>0||l++;let h=0;a.names[0]&&(h+=2),a.birth&&(h+=2),a.death&&(h+=2),a.sex&&(h+=1),a.birthPlace&&(h+=1),a.parents.length>0&&(h+=2),u+=h});const x=(a,r=new Set)=>{if(r.has(a))return!0;const h=s.find(p=>p.id===a);if(!h)return!1;r.add(a);for(const p of h.parents)if(x(p,new Set(r)))return!0;return!1};s.slice(0,100).forEach(a=>{x(a.id)&&t.push({type:"genealogical_loop",message:(a.names[0]||a.id)+": Boucle gÃ©nÃ©alogique dÃ©tectÃ©e"})});const o={};s.forEach(a=>{o[a.id]=(o[a.id]||0)+1}),Object.entries(o).forEach(([a,r])=>{r>1&&t.push({type:"duplicate_id",message:"ID "+a+" dupliquÃ© "+r+" fois"})});const n=s.length>0?Math.round(u/(s.length*10)*100):0;return{errors:t,warnings:c,isolatedCount:l,completenessScore:n,errorCount:t.length,warningCount:c.length,totalChecked:s.length}},ve=s=>s.avgScore||0,ae=()=>W.filter(s=>ve(s)>=B),Ge=()=>{const s=new Set;W.forEach((i,t)=>{ve(i)>=B&&s.add(t)}),ee(s)},He=s=>{const i=new Set(j);g.forEach(t=>{s.includes(t.person1.id)&&s.includes(t.person2.id)&&i.add(t.id)}),_(i)},Ve=s=>{const i=new Set(X);i.has(s)?i.delete(s):i.add(s),ue(i)},we=s=>{let i=0;return s.names[0]?.length>5&&(i+=10),s.birth&&(i+=8),s.death&&(i+=6),s.sex&&(i+=4),s.birthPlace&&(i+=7),s.deathPlace&&(i+=5),i+=s.parents.length*6,i+=s.spouses.length*5,s.occupation&&(i+=4),s.familyAsChild&&(i+=3),i+=s.familiesAsSpouse.length*3,i},Je=s=>Q(s),ne=()=>Q(null),Ce=s=>{const i=new Set(j);i.has(s)?i.delete(s):i.add(s),_(i)},Ke=()=>{const s=g.filter(i=>i.similarity>=z).map(i=>i.id);_(new Set(s))},R=s=>E.find(t=>t.id===s)?.names[0]||s,Ye=s=>{const i=s.target.files[0];if(i){y(i),k(5);const t=new FileReader;t.onload=c=>{const l=c.target.result;oe(l),k(15);const{people:u,families:d}=Fe(l);k(30),v(u),Ne(d);const x=Ue(u);N(x);const o=qe(u,d);ge(o);const n=$e(u);be(n);const a=We(u,d);je(a),k(100),q("review")},t.readAsText(i)}},Qe=()=>{if(j.size===0)return;const s=new Map;g.forEach(t=>{if(j.has(t.id)){const c=we(t.person1),l=we(t.person2),u=c>=l?t.person1:t.person2,d=t.person1.id,x=t.person2.id;let o=u.id;s.has(d)?o=s.get(d):s.has(x)&&(o=s.get(x)),s.set(d,o),s.set(x,o)}}),K(s);const i=new Set;s.forEach((t,c)=>{c!==t&&i.add(c)}),Y({totalIndividuals:E.length,mergedCount:i.size,deletedCount:0,remainingCount:E.length-i.size}),q("merged")},Xe=()=>{w.size!==0&&window.confirm("âš ï¸ Vous allez SUPPRIMER dÃ©finitivement "+w.size+` individu(s) de votre arbre.

Cette action est irrÃ©versible. Continuer ?`)&&(K(new Map),Y({totalIndividuals:E.length,mergedCount:0,deletedCount:w.size,remainingCount:E.length-w.size}),q("merged"))},Ze=()=>{if(!de)return;const s=new Set,i=new Map;Ie.forEach((n,a)=>{a!==n&&(s.add(a),i.set(a,n))}),w.forEach(n=>s.add(n));const t=de.split(`
`),c=[];let l=!1;if(!(t.length>0&&t[0].trim().startsWith("0 HEAD"))){c.push("0 HEAD","1 SOUR GedcomMerger","2 VERS "+ye,"2 NAME Fusionneur de Doublons GEDCOM","1 GEDC","2 VERS 5.5.1","2 FORM LINEAGE-LINKED","1 CHAR UTF-8");const n=new Date,a=n.getDate()+" "+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][n.getMonth()]+" "+n.getFullYear();c.push("1 DATE "+a)}for(let n=0;n<t.length;n++){const a=t[n],r=a.trim();if(r.startsWith("0 TRLR"))continue;if(r.startsWith("0 ")&&(l=!1,r.includes("@"))){const p=r.match(/@([^@]+)@/);if(p&&s.has(p[1])){l=!0;continue}}if(l)continue;let h=a;i.forEach((p,C)=>{h=h.replace(new RegExp("@"+C+"@","g"),"@"+p+"@")}),c.push(h)}c.push("0 TRLR");const d=new Blob([c.join(`
`)],{type:"text/plain"}),x=URL.createObjectURL(d),o=document.createElement("a");o.href=x,o.download="gedcom_nettoye_"+new Date().toISOString().slice(0,10)+".ged",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(x)},le=()=>{q("upload"),v([]),N([]),_(new Set),oe(""),me(""),he(80),k(0),pe("clusters"),fe(80),ee(new Set),xe([]),ue(new Set),ge([]),O(new Set),be([]),je(null),y(null),K(new Map),Y(null),Q(null),Ne(new Map)},es=()=>g.filter(s=>s.similarity>=z&&(!$||s.person1.names.some(i=>i.toLowerCase().includes($.toLowerCase()))||s.person2.names.some(i=>i.toLowerCase().includes($.toLowerCase())))),V=()=>{const s=new Set;return W.forEach(i=>i.ids.forEach(t=>s.add(t))),es().filter(i=>!s.has(i.person1.id)&&!s.has(i.person2.id))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-4 py-4 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Fusionneur GEDCOM"}),e.jsxs("p",{className:"text-emerald-100 text-sm",children:["v",ye," - ",te[0].title]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[F!=="upload"&&f&&e.jsxs("button",{onClick:()=>se(!0),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"IntÃ©gritÃ©"}),f.errorCount>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-red-500 rounded-full text-xs",children:f.errorCount})]}),F!=="upload"&&e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Recommencer"})]}),e.jsxs("button",{onClick:()=>Z(!0),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"NouveautÃ©s"})]})]})]})}),G>0&&G<100&&e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-300",style:{width:G+"%"}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[G,"%"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[F==="upload"&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(as,{className:"w-16 h-16 mx-auto text-emerald-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Importer votre fichier GEDCOM"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Glissez-dÃ©posez ou sÃ©lectionnez un fichier .ged"})]}),e.jsx("label",{className:"block",children:e.jsxs("div",{className:"border-2 border-dashed border-emerald-300 rounded-xl p-8 text-center cursor-pointer hover:border-emerald-500 hover:bg-emerald-50 transition-all",children:[e.jsx("input",{type:"file",accept:".ged,.gedcom",onChange:Ye,className:"hidden"}),e.jsx(ns,{className:"w-12 h-12 mx-auto text-emerald-400 mb-3"}),e.jsx("p",{className:"text-emerald-600 font-medium",children:"Cliquez pour sÃ©lectionner"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"ou glissez-dÃ©posez ici"})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"NouveautÃ© v1.9.3"]}),e.jsx("p",{className:"text-blue-700 text-sm mt-1",children:'Nouvel onglet "Ã€ supprimer" avec critÃ¨res stricts : individus totalement isolÃ©s (sans famille) ou sans identitÃ©. Bouton flottant pour actions rapides.'})]})]})}),F==="review"&&e.jsxs("div",{children:[f&&f.errors.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-red-800 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),f.errors.length," erreur(s) dÃ©tectÃ©e(s)"]}),e.jsx("ul",{className:"mt-2 text-sm text-red-700",children:f.errors.slice(0,5).map((s,i)=>e.jsxs("li",{children:["â€¢ ",s.message]},i))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:E.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Individus"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:W.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Clusters"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:V().length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Doublons"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:P.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Ã€ supprimer"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:H.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Suggestions IA"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border overflow-hidden",children:[e.jsx("div",{className:"flex border-b",children:[{id:"clusters",label:"Clusters",icon:"ðŸŸ ",count:ae().length},{id:"pairs",label:"Doublons",icon:"ðŸ”µ",count:V().length},{id:"toDelete",label:"Ã€ supprimer",icon:"ðŸ—‘ï¸",count:P.length},{id:"ai",label:"Suggestions IA",icon:"ðŸŸ£",count:H.length}].map(s=>e.jsxs("button",{onClick:()=>pe(s.id),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${U===s.id?"bg-emerald-50 text-emerald-700 border-b-2 border-emerald-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"mr-1",children:s.icon}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-gray-100 rounded-full text-xs",children:s.count})]},s.id))}),e.jsxs("div",{className:"p-4",children:[U==="clusters"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Score min:"}),e.jsx("input",{type:"range",min:"80",max:"100",value:B,onChange:s=>fe(parseInt(s.target.value)),className:"w-24"}),e.jsxs("span",{className:"text-sm font-medium",children:[B,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ge,className:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700",children:["SÃ©lectionner â‰¥",B,"%"]}),e.jsx("button",{onClick:()=>ee(new Set),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600",children:"DÃ©sÃ©lectionner tout"})]})]}),ae().length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun cluster trouvÃ© avec ce filtre"}):e.jsx("div",{className:"space-y-3",children:ae().map((s,i)=>e.jsxs("div",{className:`border rounded-lg p-3 ${ke.has(i)?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium",children:[s.size," personnes"]}),e.jsxs("span",{className:`px-2 py-0.5 rounded text-sm ${s.avgScore>=95?"bg-green-100 text-green-800":s.avgScore>=90?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:["Score: ",s.avgScore,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ve(i),className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200 flex items-center gap-1",children:X.has(i)?e.jsxs(e.Fragment,{children:["RÃ©duire ",e.jsx(ls,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["DÃ©tails ",e.jsx(rs,{className:"w-4 h-4"})]})}),e.jsx("button",{onClick:()=>He(s.ids),className:"px-3 py-1 text-sm bg-emerald-600 text-white rounded hover:bg-emerald-700",children:"SÃ©lectionner"})]})]}),X.has(i)&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"#"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"ID"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Nom complet"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Sexe"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Naissance"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Lieu naiss."}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"DÃ©cÃ¨s"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Lieu dÃ©cÃ¨s"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Profession"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Parents"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Conjoints"}),e.jsx("th",{className:"px-2 py-1 text-left font-medium text-gray-600",children:"Enfants"})]})}),e.jsx("tbody",{children:s.people.map((t,c)=>e.jsxs("tr",{className:c%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1 text-gray-500",children:c+1}),e.jsx("td",{className:"px-2 py-1 text-xs text-gray-400 font-mono",children:t.id}),e.jsx("td",{className:"px-2 py-1 font-medium",children:t.names[0]||"-"}),e.jsx("td",{className:"px-2 py-1",children:t.sex==="M"?"â™‚":t.sex==="F"?"â™€":"-"}),e.jsx("td",{className:"px-2 py-1",children:t.birth||"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.birthPlace||"-"}),e.jsx("td",{className:"px-2 py-1",children:t.death||"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.deathPlace||"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.occupation||"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.parents.length>0?t.parents.map(l=>R(l)).join(", "):"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.spouses.length>0?t.spouses.map(l=>R(l)).join(", "):"-"}),e.jsx("td",{className:"px-2 py-1 text-xs",children:t.children?.length>0?t.children.map(l=>R(l)).join(", "):"-"})]},t.id))})]})}),e.jsxs("div",{className:"mt-2 pt-2 border-t text-xs text-gray-500 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["ðŸ“Š Avec naissance: ",s.people.filter(t=>t.birth).length,"/",s.size]}),e.jsxs("span",{children:["ðŸ“Š Avec dÃ©cÃ¨s: ",s.people.filter(t=>t.death).length,"/",s.size]}),e.jsxs("span",{children:["ðŸ“Š Avec profession: ",s.people.filter(t=>t.occupation).length,"/",s.size]}),e.jsxs("span",{children:["ðŸ“Š Paires liÃ©es: ",s.pairs?.length||0]})]})]})]},i))})]}),U==="pairs"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Rechercher par nom ou ID...",value:$,onChange:s=>me(s.target.value),className:"px-3 py-2 border rounded-lg text-sm flex-1 min-w-[200px]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Score min:"}),e.jsx("input",{type:"range",min:"80",max:"100",value:z,onChange:s=>he(parseInt(s.target.value)),className:"w-24"}),e.jsxs("span",{className:"text-sm font-medium",children:[z,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ke,className:"px-3 py-1 bg-emerald-600 text-white text-sm rounded-lg hover:bg-emerald-700",children:["SÃ©lectionner â‰¥",z,"%"]}),e.jsx("button",{onClick:()=>_(new Set),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600",children:"DÃ©sÃ©lectionner tout"})]})]}),V().length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun doublon simple trouvÃ©"}):e.jsx("div",{className:"space-y-2",children:V().slice(0,50).map(s=>e.jsxs("div",{className:`border rounded-lg p-3 ${j.has(s.id)?"border-emerald-500 bg-emerald-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.person1.names[0]||s.person1.id}),e.jsxs("div",{className:"text-sm text-gray-500",children:["â†” ",s.person2.names[0]||s.person2.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${s.similarity>=95?"bg-green-100 text-green-800":s.similarity>=90?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:[s.similarity,"%"]}),e.jsx("button",{onClick:()=>Je(s),className:"px-2 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"PrÃ©visualiser"}),e.jsx("button",{onClick:()=>Ce(s.id),className:`px-2 py-1 text-sm rounded ${j.has(s.id)?"bg-emerald-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:j.has(s.id)?"âœ“":"SÃ©lectionner"})]})]}),s.sufficientCriteria&&s.sufficientCriteria.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-emerald-600",children:["CritÃ¨res validants: ",s.sufficientCriteria.join(", ")]})]},s.id))})]}),U==="toDelete"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("button",{onClick:()=>O(new Set(P.map(s=>s.id))),className:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700",children:"Tout sÃ©lectionner"}),e.jsx("button",{onClick:()=>O(new Set(P.filter(s=>s.isTotallyIsolated).map(s=>s.id))),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700",children:"Totalement isolÃ©s"}),e.jsx("button",{onClick:()=>O(new Set(P.filter(s=>s.hasNoIdentity).map(s=>s.id))),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700",children:"Sans identitÃ©"}),e.jsx("button",{onClick:()=>O(new Set),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600",children:"DÃ©sÃ©lectionner tout"}),e.jsxs("span",{className:"text-sm text-gray-500 self-center",children:[w.size," sÃ©lectionnÃ©(s)"]})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Totalement isolÃ©s:"})," ",P.filter(s=>s.isTotallyIsolated).length,e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("span",{className:"font-medium",children:"Sans identitÃ©:"})," ",P.filter(s=>s.hasNoIdentity).length]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CritÃ¨res: totalement isolÃ© (sans parents, enfants, conjoints) OU sans nom/prÃ©nom"})]}),P.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucun individu Ã  supprimer trouvÃ©"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P.map(s=>e.jsx("div",{className:`border rounded-lg p-3 ${w.has(s.id)?"border-red-500 bg-red-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.names[0]||"[ID: "+s.id+"]"}),e.jsx("div",{className:"flex gap-2 mt-1",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.reason==="IsolÃ© + Sans identitÃ©"?"bg-purple-100 text-purple-800":s.reason==="Totalement isolÃ©"?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"}`,children:s.reason})})]}),e.jsx("button",{onClick:()=>{const i=new Set(w);i.has(s.id)?i.delete(s.id):i.add(s.id),O(i)},className:`px-2 py-1 text-sm rounded ${w.has(s.id)?"bg-red-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:w.has(s.id)?"âœ“":"SÃ©lectionner"})]})},s.id))})]}),U==="ai"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800",children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Analyse de patterns"})]}),e.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"Ces suggestions sont basÃ©es sur l'analyse des noms, pÃ©riodes et lieux. VÃ©rifiez chaque suggestion avant de l'accepter."})]}),H.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune suggestion IA disponible"}):e.jsx("div",{className:"space-y-3",children:H.map((s,i)=>e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-purple-50/30",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:`px-2 py-1 rounded text-sm font-medium ${s.confidence>=90?"bg-green-100 text-green-800":s.confidence>=75?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:["Confiance: ",s.confidence,"%"]})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:s.person1.names[0]||s.person1.id}),e.jsxs("div",{className:"text-gray-500",children:["â†” ",s.person2.names[0]||s.person2.id]})]}),e.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:["Raisons: ",s.reasons.join(" â€¢ ")]})]},i))})]})]})]}),(j.size>0||w.size>0)&&e.jsxs("div",{className:"fixed bottom-6 right-6 flex flex-col gap-2 z-50",children:[j.size>0&&e.jsxs("button",{onClick:Qe,className:"px-6 py-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Fusionner ",j.size," doublon(s)"]}),w.size>0&&e.jsxs("button",{onClick:Xe,className:"px-6 py-3 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 font-medium flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),"Supprimer ",w.size," individu(s)"]})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:le,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Recommencer"})})]}),F==="merged"&&L&&e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(De,{className:"w-16 h-16 mx-auto text-emerald-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Traitement terminÃ© !"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:L.totalIndividuals}),e.jsx("div",{className:"text-sm text-gray-500",children:"Avant"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["-",L.mergedCount+L.deletedCount]}),e.jsx("div",{className:"text-sm text-gray-500",children:L.mergedCount>0&&L.deletedCount>0?"FusionnÃ©s + SupprimÃ©s":L.mergedCount>0?"FusionnÃ©s":"SupprimÃ©s"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:L.remainingCount}),e.jsx("div",{className:"text-sm text-gray-500",children:"AprÃ¨s"})]})]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:Ze,className:"w-full px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-medium flex items-center justify-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"}),"TÃ©lÃ©charger le fichier nettoyÃ©"]}),e.jsx("button",{onClick:le,className:"w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Traiter un autre fichier"})]})]})})]}),Me&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ee,{className:"w-6 h-6"}),"Historique des versions"]}),e.jsx("button",{onClick:()=>Z(!1),className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:te.map((s,i)=>e.jsxs("div",{className:`mb-6 pb-6 ${i<te.length-1?"border-b":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${s.color}-100 text-${s.color}-800`,children:["v",s.version]}),s.tag&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${s.tag==="ACTUELLE"?"bg-green-500 text-white":"bg-gray-200"}`,children:s.tag}),e.jsx("span",{className:"text-sm text-gray-500",children:s.date})]}),e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:s.title}),e.jsx("ul",{className:"space-y-1",children:s.items.map((t,c)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-500 mt-1",children:"â€¢"}),e.jsx("span",{children:t})]},c))})]},i))}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t",children:e.jsx("button",{onClick:()=>Z(!1),className:"w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:"Fermer"})})]})}),Oe&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:`sticky top-0 px-6 py-4 ${f.errorCount>0?"bg-red-600":f.warningCount>0?"bg-yellow-600":"bg-green-600"} text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ae,{className:"w-6 h-6"}),"Rapport d'intÃ©gritÃ©"]}),e.jsx("button",{onClick:()=>se(!1),className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:f.totalChecked}),e.jsx("div",{className:"text-sm text-gray-500",children:"Individus analysÃ©s"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.errorCount}),e.jsx("div",{className:"text-sm text-red-500",children:"Erreurs"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:f.warningCount}),e.jsx("div",{className:"text-sm text-yellow-500",children:"Avertissements"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[f.completenessScore,"%"]}),e.jsx("div",{className:"text-sm text-blue-500",children:"ComplÃ©tude"})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Personnes isolÃ©es:"})," ",f.isolatedCount]})}),f.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"font-semibold text-red-800 mb-2",children:["Erreurs (",f.errors.length,")"]}),e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:[f.errors.slice(0,20).map((s,i)=>e.jsxs("div",{className:"text-sm p-2 bg-red-50 rounded text-red-700",children:["â€¢ ",s.message]},i)),f.errors.length>20&&e.jsxs("p",{className:"text-sm text-gray-500",children:["... et ",f.errors.length-20," autres erreurs"]})]})]}),f.warnings.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-yellow-800 mb-2",children:["Avertissements (",f.warnings.length,")"]}),e.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:[f.warnings.slice(0,20).map((s,i)=>e.jsxs("div",{className:"text-sm p-2 bg-yellow-50 rounded text-yellow-700",children:["â€¢ ",s.message]},i)),f.warnings.length>20&&e.jsxs("p",{className:"text-sm text-gray-500",children:["... et ",f.warnings.length-20," autres avertissements"]})]})]}),f.errorCount===0&&f.warningCount===0&&e.jsxs("div",{className:"text-center py-8 text-green-600",children:[e.jsx(De,{className:"w-16 h-16 mx-auto mb-4"}),e.jsx("p",{className:"font-semibold",children:"Aucun problÃ¨me dÃ©tectÃ© !"})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t",children:e.jsx("button",{onClick:()=>se(!1),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Fermer"})})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"sticky top-0 bg-emerald-600 text-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"PrÃ©visualisation de la fusion"}),e.jsx("button",{onClick:ne,className:"p-2 hover:bg-white/20 rounded-lg",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:m.person1.names[0]||m.person1.id}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ID:"})," ",e.jsx("span",{className:"font-mono",children:m.person1.id})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sexe:"})," ",m.person1.sex==="M"?"â™‚ Masculin":m.person1.sex==="F"?"â™€ FÃ©minin":"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Naissance:"})," ",m.person1.birth||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Lieu naissance:"})," ",m.person1.birthPlace||"N/A"]}),m.person1.baptism&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"BaptÃªme:"})," ",m.person1.baptism," ",m.person1.baptismPlace&&`(${m.person1.baptismPlace})`]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"DÃ©cÃ¨s:"})," ",m.person1.death||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Lieu dÃ©cÃ¨s:"})," ",m.person1.deathPlace||"N/A"]}),m.person1.burial&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Inhumation:"})," ",m.person1.burial," ",m.person1.burialPlace&&`(${m.person1.burialPlace})`]}),m.person1.occupation&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Profession:"})," ",m.person1.occupation]}),m.person1.title&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Titre:"})," ",m.person1.title]}),m.person1.residence&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"RÃ©sidence:"})," ",m.person1.residence]}),m.person1.religion&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Religion:"})," ",m.person1.religion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Parents:"})," ",m.person1.parents.length>0?m.person1.parents.map(s=>R(s)).join(", "):"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Conjoints:"})," ",m.person1.spouses.length>0?m.person1.spouses.map(s=>R(s)).join(", "):"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Enfants:"})," ",m.person1.children?.length>0?m.person1.children.map(s=>R(s)).join(", "):"N/A"]}),m.person1.note&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Note:"})," ",m.person1.note]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:m.person2.names[0]||m.person2.id}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ID:"})," ",e.jsx("span",{className:"font-mono",children:m.person2.id})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sexe:"})," ",m.person2.sex==="M"?"â™‚ Masculin":m.person2.sex==="F"?"â™€ FÃ©minin":"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Naissance:"})," ",m.person2.birth||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Lieu naissance:"})," ",m.person2.birthPlace||"N/A"]}),m.person2.baptism&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"BaptÃªme:"})," ",m.person2.baptism," ",m.person2.baptismPlace&&`(${m.person2.baptismPlace})`]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"DÃ©cÃ¨s:"})," ",m.person2.death||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Lieu dÃ©cÃ¨s:"})," ",m.person2.deathPlace||"N/A"]}),m.person2.burial&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Inhumation:"})," ",m.person2.burial," ",m.person2.burialPlace&&`(${m.person2.burialPlace})`]}),m.person2.occupation&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Profession:"})," ",m.person2.occupation]}),m.person2.title&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Titre:"})," ",m.person2.title]}),m.person2.residence&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"RÃ©sidence:"})," ",m.person2.residence]}),m.person2.religion&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Religion:"})," ",m.person2.religion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Parents:"})," ",m.person2.parents.length>0?m.person2.parents.map(s=>R(s)).join(", "):"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Conjoints:"})," ",m.person2.spouses.length>0?m.person2.spouses.map(s=>R(s)).join(", "):"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Enfants:"})," ",m.person2.children?.length>0?m.person2.children.map(s=>R(s)).join(", "):"N/A"]}),m.person2.note&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Note:"})," ",m.person2.note]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"DÃ©tails de la comparaison"}),e.jsx("div",{className:"text-sm space-y-1",children:m.details.map((s,i)=>e.jsx("p",{className:"text-gray-600",children:s},i))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 border-t flex gap-3",children:[e.jsx("button",{onClick:ne,className:"flex-1 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Fermer"}),e.jsx("button",{onClick:()=>{Ce(m.id),ne()},className:`flex-1 px-4 py-2 rounded-lg ${j.has(m.id)?"bg-red-500 text-white hover:bg-red-600":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:j.has(m.id)?"DÃ©sÃ©lectionner":"SÃ©lectionner pour fusion"})]})]})})]})};ce.createRoot(document.getElementById("root")).render(e.jsx(ts.StrictMode,{children:e.jsx(gs,{})}));
